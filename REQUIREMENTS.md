# イベントカウントダウンサイト開発仕様書

## プロジェクト概要

日本全国のイベントをカウントダウン形式で表示するWebサービスのMVP（最小実行可能製品）を開発します。

### サービス名称案
- **EventTicker** - イベント情報をリアルタイムで刻むという意味
- **CountdownHub** - カウントダウンの中心地という意味
- **TickTock Events** - 時間の経過を表現し、覚えやすい

## 技術スタック

### フロントエンド
- **React** with TypeScript
- **Tailwind CSS** (レスポンシブデザイン対応)
- **React Router** (ページ遷移)
- **React Query** (データフェッチング)

### バックエンド
- **Node.js** with Express.js
- **TypeScript**
- **PostgreSQL** (データベース)
- **Prisma** (ORM)

### 開発環境
- **Docker** & **Docker Compose**
- **GitHub** (バージョン管理)
- **ESLint** & **Prettier** (コード品質)

## データベース設計

### テーブル構造

#### events テーブル
```sql
CREATE TABLE events (
  id SERIAL PRIMARY KEY,
  title VARCHAR(255) NOT NULL,
  description TEXT,
  start_datetime TIMESTAMP WITH TIME ZONE NOT NULL,
  end_datetime TIMESTAMP WITH TIME ZONE,
  location VARCHAR(255),
  venue_type VARCHAR(20) CHECK (venue_type IN ('online', 'offline', 'hybrid')),
  site_url VARCHAR(500),
  image_url VARCHAR(500),
  tags TEXT[], -- PostgreSQLの配列型
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

#### comments テーブル
```sql
CREATE TABLE comments (
  id SERIAL PRIMARY KEY,
  event_id INTEGER REFERENCES events(id) ON DELETE CASCADE,
  author_name VARCHAR(100) NOT NULL,
  content TEXT NOT NULL,
  is_reported BOOLEAN DEFAULT false,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

## 機能要件詳細

### 1. メイン画面（イベント一覧）
- **表示形式**: カード/パネル形式でイベント表示
- **カウントダウン表示**: 大きく見やすいフォントで残り時間を表示
- **ソート機能**: 
  - デフォルト: 開催日時の近い順
  - 追加順（作成日時順）
  - 人気順（コメント数順）
- **ページネーション**: 初期表示20件、無限スクロール対応
- **UI優先度**: カウントダウンが短いほど大きく、目立つ表示

### 2. 検索・フィルタリング機能
- **テキスト検索**: タイトル、説明文での部分一致検索
- **タグフィルタ**: 複数タグでの絞り込み
- **開催形式フィルタ**: オンライン/オフライン/ハイブリッド
- **日付範囲フィルタ**: 指定期間内のイベント表示

### 3. イベント詳細ページ
- **表示項目**:
  - イベントタイトル
  - カウントダウンタイマー
  - 開催日時（JST表示）
  - イベント概要
  - アイキャッチ画像
  - 公式サイトURL
  - 開催場所
  - タグ一覧
  - オンライン/オフライン区分
- **コメント機能**: 
  - コメント投稿（名前入力必須）
  - 通報機能
  - 管理者による削除機能

### 4. イベント登録機能
- **個別登録**: フォームからの単体登録
- **CSV一括登録**: 管理者用の一括インポート機能
- **必須項目**: タイトル、開催日時
- **任意項目**: その他全項目

### 5. 管理者画面
- **イベント管理**: CRUD操作、公開/非公開切り替え
- **コメント管理**: 削除、通報されたコメントの確認
- **CSV一括登録**: ファイルアップロード機能
- **統計情報**: イベント数、コメント数の表示

## API設計

### エンドポイント一覧

#### イベント関連
- `GET /api/events` - イベント一覧取得（検索・フィルタ・ソート対応）
- `GET /api/events/:id` - イベント詳細取得
- `POST /api/events` - イベント新規登録
- `PUT /api/events/:id` - イベント更新
- `DELETE /api/events/:id` - イベント削除

#### コメント関連
- `GET /api/events/:id/comments` - イベントのコメント一覧取得
- `POST /api/events/:id/comments` - コメント投稿
- `DELETE /api/comments/:id` - コメント削除
- `POST /api/comments/:id/report` - コメント通報

#### 管理者関連
- `POST /api/admin/events/import` - CSV一括登録
- `GET /api/admin/stats` - 統計情報取得

## UI/UX設計指針

### レスポンシブデザイン
- **モバイルファースト**: 320px以上のデバイス対応
- **ブレークポイント**: 
  - Mobile: ~768px
  - Tablet: 768px~1024px  
  - Desktop: 1024px~

### カウントダウン表示
- **リアルタイム更新**: 1秒間隔での更新
- **視覚的階層**: 残り時間が短いほど大きく、鮮やかな色で表示
- **表示形式**: "○日 ○時間 ○分 ○秒" または "○時間 ○分 ○秒"

### カラーパレット（推奨）
- **プライマリ**: 緊急度に応じたグラデーション
  - 7日以上: 青系（#3B82F6）
  - 3-7日: 黄系（#F59E0B）
  - 1-3日: オレンジ系（#F97316）
  - 24時間以内: 赤系（#EF4444）

## 開発フェーズ

### Phase 1: 基盤構築
1. プロジェクト初期化とDocker環境構築
2. データベース設計とマイグレーション
3. 基本的なAPI実装
4. フロントエンド基盤構築

### Phase 2: コア機能実装
1. イベント一覧表示機能
2. カウントダウン機能
3. イベント詳細ページ
4. 検索・フィルタ機能

### Phase 3: 追加機能実装
1. コメント機能
2. イベント登録機能
3. 管理者画面
4. CSV一括登録機能

### Phase 4: 品質向上
1. テストコード作成
2. パフォーマンス最適化
3. セキュリティ対策
4. ドキュメント整備

## セキュリティ要件

### 基本対策
- **入力値検証**: 全てのユーザー入力に対するバリデーション
- **SQLインジェクション対策**: Prisma ORMの使用
- **XSS対策**: HTMLエスケープ処理
- **CSRF対策**: CSRFトークンの実装
- **レート制限**: API呼び出し回数制限

### データ保護
- **機密データ暗号化**: 環境変数での機密情報管理
- **HTTPS通信**: 本番環境でのSSL/TLS実装
- **ログ管理**: 個人情報を含まないログ出力

## パフォーマンス要件

### 応答時間目標
- **ページ初期表示**: 2秒以内
- **API レスポンス**: 500ms以内
- **カウントダウン更新**: 遅延なし

### 最適化手法
- **データベースインデックス**: 検索対象カラムにインデックス設定
- **キャッシュ戦略**: React Queryでのデータキャッシュ
- **画像最適化**: WebP形式推奨、遅延読み込み
- **コード分割**: React.lazyでの動的インポート

## 拡張性考慮

### 将来的な機能拡張
- **外部API連携**: イベント情報の自動取得機能
- **ユーザー認証**: ログイン機能とお気に入り機能
- **通知機能**: イベント開始前のリマインダー
- **ソーシャル機能**: イベントの共有機能

### アーキテクチャ拡張
- **マイクロサービス化**: 機能別サービス分離の準備
- **CDN導入**: 静的ファイル配信の高速化
- **ロードバランサ**: 高トラフィック対応

## 開発・運用フロー

### 開発環境セットアップ
```bash
# リポジトリクローン
git clone <repository-url>
cd event-countdown-site

# Docker環境起動
docker-compose up -d

# 依存関係インストール
npm install

# データベースマイグレーション
npx prisma migrate dev

# 開発サーバー起動
npm run dev
```

### Git ブランチ戦略
- **main**: 本番環境用
- **develop**: 開発環境用
- **feature/**: 機能開発用ブランチ
- **hotfix/**: 緊急修正用ブランチ

## 品質保証

### テスト戦略
- **単体テスト**: Jest + React Testing Library
- **統合テスト**: API エンドポイントテスト
- **E2Eテスト**: Playwright（必要に応じて）

### コード品質
- **リンター**: ESLint + Prettier
- **型チェック**: TypeScript strict mode
- **コードレビュー**: Pull Request必須

## 運用・保守

### 監視・ログ
- **アプリケーションログ**: 構造化ログ出力
- **エラー監視**: コンソールエラーの記録
- **パフォーマンス監視**: 応答時間の計測

### バックアップ戦略
- **データベース**: 日次バックアップ
- **ファイルストレージ**: 定期バックアップ

## Claude Code実装時の注意事項

### 効率的な開発のために
1. **段階的実装**: 上記フェーズに従った順次実装
2. **明確な要件**: 各機能の具体的な動作を詳細に指定
3. **コンポーネント設計**: 再利用可能な小さなコンポーネントでの構築
4. **エラーハンドリング**: 全ての異常系処理を明示的に指定

### コスト最適化
1. **一括実装**: 関連機能をまとめて実装指示
2. **テンプレート活用**: 類似画面・機能の共通化
3. **明確な仕様**: 実装の試行錯誤を減らすための詳細仕様
4. **優先順位**: MVP機能を優先した実装順序

### ハルシネーション抑制
1. **具体的指示**: 抽象的な表現を避けた具体的な実装指示
2. **既存パターン**: 一般的な実装パターンの明示
3. **制約条件**: 技術的制約の明確化
4. **検証可能**: 実装結果の確認方法を明示

この仕様書に基づいて、Claude Codeに段階的に実装を依頼することで、効率的で高品質なイベントカウントダウンサイトを開発できます。